#!/usr/bin/env bash

#
# rserver-automation
#
# Copyright (C) 2022 by Posit Software, PBC
#
# Unless you have received this program directly from Posit Software pursuant
# to the terms of a commercial license agreement with Posit Software, then
# this program is licensed to you under the terms of version 3 of the
# GNU Affero General Public License. This program is distributed WITHOUT
# ANY EXPRESS OR IMPLIED WARRANTY, INCLUDING THOSE OF NON-INFRINGEMENT,
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. Please refer to the
# AGPL (http://www.gnu.org/licenses/agpl-3.0.txt) for more details.
#
#

# use temporary directory for RStudio state
ROOT=/tmp/rstudio-automation

export RSTUDIO_CONFIG_HOME="${ROOT}/rstudio-config-home"
export RSTUDIO_CONFIG_DIR="${ROOT}/rstudio-config-dir"
export RSTUDIO_DATA_HOME="${ROOT}/rstudio-data-home"

cat <<- EOF > /tmp/rserver-database.conf
provider=sqlite
directory=${ROOT}
EOF

# run the usual server development script
./rserver-dev                                           \
	--auth-none=1                                       \
	--www-port=8788                                     \
	--server-data-dir="${ROOT}"                         \
	--database-config-file="/tmp/rserver-database.conf" \
	"$@"

