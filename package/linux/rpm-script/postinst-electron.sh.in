#!/bin/sh

# errors shouldn't cause script to exit
set +e 

# create softlink to rstudio in /usr/bin
ln -f -s ${CMAKE_INSTALL_PREFIX}/rstudio /usr/bin/rstudio

# create openssl softlinks based off Fedora version 
if test -f /etc/fedora-release
then
  if test -d /usr/lib64 || test -d /lib64
  then
    architecture_dir='lib64'
  else
    architecture_dir='lib'
  fi

  compare_versions() { test "$(echo "$@" | tr " " "\n" | sort -V | head -n 1)" != "$1"; }
  version_number=$(cat /etc/fedora-release | sed 's/[^0-9,.]*//g')

  # verify if release version number is greater than 25
  if compare_versions $version_number 25
  then
    mkdir -p ${CMAKE_INSTALL_PREFIX}/bin
    ln -s -f /$architecture_dir/libssl.so.10 ${CMAKE_INSTALL_PREFIX}/bin/libssl.so.1.0.0
    ln -s -f /$architecture_dir/libcrypto.so.10 ${CMAKE_INSTALL_PREFIX}/bin/libcrypto.so.1.0.0
  fi
fi

# note: Yaru icon theme symlink workaround is DEB-only (Ubuntu-specific)

# refresh mime database and icon cache
if command -v update-mime-database > /dev/null; then
   if ! update-mime-database /usr/share/mime > /dev/null; then
      echo "rstudio postinst: warning: update-mime-database failed" >&2
   fi
fi
if command -v gtk-update-icon-cache > /dev/null; then
   if ! gtk-update-icon-cache -f -t /usr/share/icons/hicolor > /dev/null; then
      echo "rstudio postinst: warning: gtk-update-icon-cache failed for hicolor" >&2
   fi
fi

# clear error termination state
set -e
